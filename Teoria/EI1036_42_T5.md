### Tema 4:

### ECMASCRIPT

### DOM

### NAVEGADOR WEB

#### EI1036 EI

#### Dolores María Llidó Escrivá

```
Curso 2017 – 2018
```

# Índice

1.2. Introducción: Emacs/JS/AngularJavaScript

3. DOM (^) a. PHP

4. Componentes de los Navegadores:CSSOM, RenderTreeb. JAVASCRIPT^
5. JavaScript NaveGadora. BOM
    b.c. Event TargetWindow
    d.e. DocumentElement
6. Templatatef. This

7. Json: (^) a. Json en JS
b. Json enPHP


## 1. Introducción EMACScript

★ El lenguaje **JavaScript** se creó inicialmente para los
navegadores web.
★ En 1997 JavaScript adoptado como estándar de la European
Computer Manufacturers Association ECMA.
★ Evolucionó en un lenguaje con muchos usos y plataformas:
**EMACScript**.
★ Una **plataforma** puede ser un cliente web (Chrome) o un
servidor web ( Node.js) u otro anfitrión.
★ El **Script Engine** (webkit->safari,v8->Chrome,node.js) **,** es el
programa que ejecuta código en un dialecto del lenguaje de
script (JavaScript) en una plataforma.


## ECMAScript:Script Engine

★El **Script Engine** proporciona
además del núcleo del
lenguaje, los objetos y
funciones específicos de la
plataforma.
✓Cada navegador tiene su
propia implementación. Por
ejemplo WebApi en mozilla.


## ECMAScript

Year Name Description
1997 ECMAScript 1 First Edition.
1998 ECMAScript 2 Editorial changes only.
1999 ECMAScript 3 Added Regular Expressions, Try/catch.
**ECMAScript 4 Was never released.**
2009 ECMAScript 5 Added "strict mode",JSON support.
2011 ECMAScript 5.1Editorial changes.
2015 ECMAScript 6 Added classes and modules.
2016 ECMAScript 7 Added exponential operator ,Array.prototype.includes.


## Dialectos/Api

★ JavaScript, JScript y ActionScript son un dialectos de
ECMAScript.
★ Los **dialecto** s incluyen extensiones al lenguaje y **API** s.
★ Una aplicación escrita en un dialecto puede ser incompatible
con otra, si no utilizan un subconjunto común de
características o **APIs compatibles**
✓ **DOM** para manipular documentos HTML, XML y SVG


## Typescript/Angular

★ TypeScript es un lenguaje de programación libre y de código abierto
desarrollado por Microsoft.
✓ Es un **superconjunto de JavaScript** , que esencialmente añade tipado
estático y objetos basados en clases.
✓ Los navegadores no convertirán TypeScript a Javascript.
✓ Mediante un Transpiler que convierte de código TypeScript a JavaScript.
✓ Se puede usar para programar tanto el cliente como el servidor (nodejs).
★ Angular framework multiplataforma para aplicaciones web (Angular 5.X )
✓ A diferencia de AngularJs o Angular1.X está programado con TypeScript
✓ Está diseñado para abstraerse del renderizado del DOM,
✓ Se puede utilizar en:Navegadores web, Servidores (Node.js), Web Workers,
Apps móviles nativas (NativeScript, React Native)

```
AngularJS (también denominado Angular 1.x). Es un nuevo framework , escrito desde cero y con conceptos y formas de trabajar completamente distintos.
Angular tiene una curva de aprendizaje bastante empinada para los desarrolladores. Está todo escrito en Typescript
```
```
7
```

## 4.2 JavaScript

###### ★Lenguaje interpretado basado en objetos.

###### ★La sintaxis es semejante al C pero las variables

###### no están tipificadas y no distingue entre

###### mayúsculas y minúsculas.

###### ★No existe un cuerpo principal del programa (main),

###### todo lo que no esté dentro de una función es

###### ejecutado.

###### ★Una función debe ser declarada antes de usarse.

###### ★En JavaScript todo son objetos.


## Objetos

★En JavaScript todo son objetos. Una lista es en realidad
una clase de objeto.
★Un objeto de JavaScript es un array asociativo formado por
las propiedades y los métodos.
★Objetos predefinidos en el núcleo de JavaScript
✓Date: Un objeto genérico conteniendo una fecha.
✓Math: Una biblioteca incorporada de funciones matemáticas y
constantes. var pi = Math.pi
✓Console: Es una interface para comunicarnos por código con la
consola.
✓this: Se refiere al objeto global fuera de las funciones.
✓this.XXX Se refiere al objeto que se está usando en el método.


## Creación de Objetos

★Instancia directa formato breve
**personObj={nombre: "Carlos Sempere”,apodo:”Doe",edad:50};**
★campos. Instancia directa con creando objeto “vacio” al que luego se añaden

**var Autor.nombre = Autor = new "Carlos Sempere"Object();** (^) **;
Autor.apodo = Autor.edad = 50;"Doe" ;
//objeto 'Autor' con atributos nombre,apodo,edad**
★Con un constructor
**function {this.nombre=nombre;Persona(nombre,apodo,edad)
this.apodo=apodo;
this.age=edad;}
var Autor= new Persona("Anas Sempere","Doe",50);**


## Ejemplo OBjeto: Array

■ Uso de un array:
var colors = ["red", "green", "blue"];
■ Crear un array vacio y luego poner los elementos:
■ var colors = new Array();
colors[0] = "red"; colors[2] = "blue"; colors[1]="green";
■ Crear un array con sus elementos:
■ var colors = new Array(3,2,1,0);


## Declaración Variables /Ambitos

★ Var: permite definir una variable **local** en una función o
**global** si está fuera de una función.
var z; // sin inicializarla
var x = 42
y = 42 // sin declarar variable
★ Let: Declara una variable local en un bloque de ámbito. Si
está dentro de {}, este es su ámbito.
let y = 13

★ Const: Declara una constante de solo lectura en un
ámbito.
const PI = 3.14;


## Ejemplo JS

let arr = [ 3 , 5 , 7 ];
arr.foo = "hola";

for (let i in arr) {
console.log(i); // logs "0", "1", "2", "foo"
}

for (let i of arr) {
console.log(i); // logs "3", "5", "7"
}


## Tipos de datos

###### ★Number: var x=5;

###### ★String: var cad='32';

###### ★Boolean: var b1=x>0;

###### ★Object var dog = { name : 'Spot', breed : 'Dalmatian' };

###### ✓Function function apellido (separador) {}

###### ✓Array: var lista = new Array(); var frutas = ['Manzana', 'Banana'];

###### ✓Date: var fin = Date.now();

###### ✓RegExp: var re = /\w+/;

###### ★null: foo=null // definida no inicialiada

###### ★Undefined typeof(y) //no definida no inicializada

###### Conversión de tipos automática:

###### var x1=x+cad; //Valor x1 número 37

###### var cad1=cad+x //valor cad1 cadena “325”


## ESpacio de Nombres

###### ★ Namespace: Contenedor que permite asociar toda la funcionalidad

###### de un determinado objeto con un nombre único.

###### ★ En JavaScript un espacio de nombres es un objeto que permite a

###### métodos, propiedades y objetos asociarse.

###### ★ El uso de los namespace permite minimizar el conflicto de

###### nombres con otros objetos haciéndolos únicos dentro de nuestra

###### aplicación.

###### ★ En los navegadores : window es el espacio de nombres, es un

###### objeto GLOBAL del que cuelgan todas las variables, funciones u

###### objetos.

###### ★ Un espacio de nombres se declara como un objeto.

###### var MYSAMPLEAPP = MYSAMPLEAPP || {}; // primero

comprobamos que no existe ese objeto y luego lo creamos. (^15)


## 4.2 Funciones

##### function NombreFuncion (parametro1, ..., parámetro N )

##### {...

##### return valor;

##### }

★Algunas Funciones Predefinidas:
✓Tipo de una variable: typeof(variable);
✓Evalúa un código JavaScript una cadena : eval(“Primera(p1, p2)”)


## Funciones

★ Las funciones son un objeto por ello podemos:
✓ asignar funciones a variables, y referenciarlas
utilizando la variable
✓ pasar funciones como parámetros a otras funciones
✓ obtener funciones como resultados de la ejecución de la
función.
**function grado() {
function titulo(name) {
return "Dr. " + name; }
return titulo; //una funcion!
}
var phd = grado();
phd("Turing"); //Dr Tuning**


## Ejemplos JavaScript(1) Try-Throw-cath

###### function getMonthName(mo) {

###### mo = mo - 1 ; // Adjust month number for array index (1 = Jan, 12 = Dec)

###### var months = ["Jan","Feb","Mar","Apr","May","Jun","Jul",

###### "Aug","Sep","Oct","Nov","Dec"];

###### if (months[mo]) { return months[mo]; }

###### else { throw "InvalidMonth"; // Lanzamos una excepción.}

###### }

###### myMonth=5;

###### try { // statements to try

###### monthName = getMonthName(myMonth); // function could throw exception

###### }

###### catch (e) {

###### monthName = "unknown";

###### console.log(e); // pass exception object to error handler -> your own function

} (^18)


## Ejemplos JavaScript(2)

###### function Primera(p1, p2) {

###### p1(p2);

###### }

###### // Función Literal

###### var Segunda = function (m1) {

###### console.log(m1 / 10 );

###### };

###### // Pasando la Función Segunda como parámetro de

###### Primera

###### Primera(Segunda, 20 );

★^ ¿Que aparecerá devuelve la llamada: Primera(Segunda, 20 );


## Función Anónima

**function (parametro1, ..., parametro N )
{ ...
return valor;
}**
★ **¿Cómo la ejecutamos si no la podemos llamar?**
✓Poniendo la definición de la función anónima entre
paréntesis **()** , y pasándole parámetros

```
✓Con return return function(quien) {alert("hola “+quien)} (‘mundo’)
```
```
/* funcion anónima sin parámetros*/
(function() { alert("hola mundo") })()
/* funcion anonima como un parametro*/
(function(quien) {alert("hola “+quien)})("mundo")
```
```
function() { alert ( "hola mundo" ) }
```

## Ejemplos JavaScript(3)

###### var f1=function(x,y)

###### {

###### var s=x+y;

###### return s;

###### }

###### console.log(f1( 4 , 6 ));

###### var f2=f1;

###### console.log(f2( 3 , 3 ));

★ ¿Que aparecerá en la pantalla?


## 2. DOM

★ El Modelo de Objetos del Documento: interfaz de lenguaje
neutral independiente de plataforma que permite a los
programas y scripts el acceso dinámico y la actualización
del contenido, la estructura o estilo de documentos(HTML,
XML y SVG.).
★ Proporciona una representación estructurada del documento
como un árbol de nodos(document, head, frame, body, p,
div..)los cuales contienen propiedades, métodos y eventos.

★ Actualmente estamos en la versión DOM4
https://www.w3.org/DOM/DOMTR o DOM Living Standar
https://dom.spec.whatwg.org/


## Origen

★ Con el auge de DHTML en el Javascript 1.0 incorporaba una
forma de acceder y manipular los elementos de la pàgina
**DOM nivel 0**.
★ El trabajo más activo en el DOM lo está realizando el
WHATWG (The Web Hypertext Application Technology Working
Group)
★ **WHATWG** se define como “ **a community of people interested in
evolving the web through standards and tests”** y su
trabajo es el borrador del **DOM4 (W3C)**


## Niveles del DOM

★ Nivel 1:
a. Núcleo:para representar cualquier documento estructurado.
b. HTML DOM: interfaces adicionales para documentos HTML.
★ Nivel 2
a. Núcleo
b. Eventos
c. Navegación
★ Nivel 3
a. Validación
b. Selectores
★ Nivel 4: Mutation Observers: reaccionar antes de cambios
en el DOM.


## Árbol del DOM:Core DOM

★ **root node:** Es el nodo raíz, Document. No tiene padre.

★ **father node:** Todos los nodos(-raíz) tienen padre.

★ **child node:** Un nodo puede tener varios hijos.

★ **leaf node:** El nodo hoja es un nodo sin hijos.

★ **sibling nodes:** los nodos hermanos tienen el mismo

padre


## Nodos: Atributos y Métodos

★ Cada **documento** tiene asociado un nodo raíz de tipo documento.
★Atributos de los nodos:
✓nodeName – Nombre del nodo x(no el atributo name)
✓nodeValue – Valor del nodo x
✓parentNode – Nodo padre de x
✓ **firstchild**
✓ **lastchild**
✓ **previousSibling**
✓ **nextSibling**
✓ **parentNode**
✓childNodes – Lista nodos hijos.
✓ **textContent –** Devuelve/cambia contenido del nodo como texto.
★Métodos de los nodos
✓appendChild(nodoy): añade 'nodoy' como hijo de 'x'
✓removeChild(nodoy): borra 'nodoy' hijo de ‘x’.
✓replaceChild(nodo1,nodo2): cambia el 'nodo2' por el 'nodo1'


## Tipos de Nodos

★DOCUMENT_NODE: Representa el documento entero.
★ELEMENT_NODE: Todo elemento (etiquetas) es un nodo
elemento.
★TEXT_NODE: Contiene el texto entre las etiquetas de un
elemento.
★COMMENT_NODE: Nodo que representa un comentario.
★DOCUMENT_TYPE_NODE: Nodo que contiene el docType del
documento.
★DOCUMENT_FRAGMENT_NODE: Nodo que representa un fragmento
de documento que debe estar bien formado (“template”).


## Document Node

★createAttribute()
★createElement()
★createTextNode()
★getElementsByTagName()
★getElementsByClassName()
★getElementById(String id)


## Element Node

★Es un nodo del documento que representa una etiqueta y su
contenido.
★Métodos:
✓getElement **s** ByTagName(nombre): lista de “element node” con
la etiqueta ‘nombre'.
✓ **getElementById(** nombre): elemento cuyo atributo “id” es el
que se especifica como parámetro.
✓getAttribute(x): Toma el valor del atributo que se
especifica como parámetro.
✓setAttribute(name, value): modifica el atributo 'name'
asignándole el valor ‘value’.


## 3. PHP DOM

★ Libreria libxml (Parser DOM):
✓ Core DOM
✓ No incluye la etiqueta Doctype.
✓ Compatible con el **DOM level 3 core**.
✓ Creación: $doc = new DOMDocument();
★ Acceso métodos:
$doc->createElement('html');
$doc->getElementByID(‘home’);
★ Generación HTML (Serialize DOM)
$doctype="<!DOCTYPE html >";
echo $doctype.$doc->saveHTML();

```
En php se accede a atributos y métodos con ->, en JavaScript on.
```

## Ejemplos PHP

★Supongamos que tenemos un DOM con **<p id=“Home”>**

```
✓doc->getElementByID(‘home’); node element p
✓doc->getElementsByTagName(“p”); X devuelve la lista de
elementos “p”
✓doc->querySelector(“#home”); node element p
✓doc->p X devuelve la lista elementos “p”
```

## EJ:DOM PHP

**<?php**
$doc = new DOMDocument();
$root = $doc->createElement('html');
$doc->appendChild($root);
$head = $doc->createElement('head');
$root->appendChild($head);

$title = $doc->createElement('title');
$title->appendChild ($doc->createTextNode('Este es el título'));
$head->appendChild($title);
$body = $doc->createElement('body');
$root->appendChild($body);
$h1 = $doc->createElement('h1');
$root->appendChild($h1);
$h1->appendChild($doc->createTextNode('Esto es el cuerpo'));
$doctype="<!DOCTYPE html >";
echo $doctype.$doc->saveHTML();
?>

**[http://dllido.al.nisu.org/Lab2017/T3/HTMLDOM.php](http://dllido.al.nisu.org/Lab2017/T3/HTMLDOM.php)** (^32)


## Ej: DOM PHP 2

<?php
$html='<html><head> <meta
charset="utf-8"><title>PHP_WEB</title></head><body><div><h1>Web page
parsing</h1><p>This is an example Web page.</p></div></body></html>';
$doc = new DOMDocument();
$doc->loadHTML ($html);
$h2 = $doc->createElement('h2');
$h1= $doc->getElementsByTagName("h1")[ 0 ];
$h1->parentNode->appendChild($h2);
$h2->appendChild($doc->createTextNode('Esto es el H2'));

$doctype="<!DOCTYPE html >";
echo $doctype.$doc->saveHTML();
?>

**[http://dllido.al.nisu.org/Lab2017/T3/HTMLDOM_Load.php](http://dllido.al.nisu.org/Lab2017/T3/HTMLDOM_Load.php)** (^33)


## DOM JavaScript

**<script type="text/javascript">
var ventana=window.open();
var father, child;
father=ventana.document.querySelector('head');
child = document.createElement('title');
child.textContent='HTMLDOM';
father.appendChild(child);
father=ventana.document.querySelector('body');
child = document.createElement('h1');
father.appendChild(child);
child.textContent='Bienvenido </br>';
child = document.createElement('h2');
child.innerHTML='Esto es el H2<br/>';
father.appendChild(child);
</script>**

```
< ?php
$doc = new DOMDocument('1.0');
$root = $doc->createElement('html');
$root = $doc->appendChild($root);
$head =
$doc->createElement('head');
$head->="bienvenido";
$head = $root->appendChild($head);
$title = $doc->createElement('title');
$title.textContent('PHPDOM');
$title = $head->appendChild($title);
$text = $doc->createTextNode('Este
es el título');
$text = $title->appendChild($text);
echo $doc->saveHTML();
?>
```
```
http://dllido.al.nisu.org/Lab2017/T4/HTMLDOM.html
```

function generate_table() {
var body = document.body;
var tbl = document.createElement("table");
var tblBody = document.createElement("tbody");
for (var i = 0; i < 2; i++) {
var row = document.createElement("tr");
for (var j = 0; j < 2; j++) {
var cell = document.createElement("td");
var cellText = document.createTextNode("cell in row "+i+", column "+j);
cell.appendChild(cellText);
row.appendChild(cell);
}// add the row to the end of the table body
tblBody.appendChild(row);
}// put the <tbody> in the <table>
tbl.appendChild(tblBody);
body.appendChild(tbl);
tbl.setAttribute("border", "2");
}
generate_table();

## Ejemplo JS con DOM

```
http://dllido.al.nisu.org/Lab2017/T4/HTML_Table_DOM.html
```

## 4. Componentes Navegador Web

★ **Interfaz de usuario** : incluye la barra de direcciones, el botón de avance/retroceso, el
menú de marcadores, etc. (todas las partes visibles del navegador, excepto la ventana
principal donde se muestra la página web.
★ **Motor del Navegador** : coordina las acciones entre la interfaz y el motor de
renderización. Carga URL, mensajes error, botón atrás,
★ **Motor de renderización** : es responsable de mostrar el contenido solicitado.
★ **Red** : responsable de las llamadas de red, como las solicitudes HTTP. Implementa la
caché de documentos para minimizar el tráfico de red.
★ **Intérprete de JavaScript** : permite analizar y ejecutar el código JavaScript. El
resultado se pasa al motor de renderización.
★ **Almacenamiento de datos** : capa de persistencia. Gestiona los datos de usuario,
tales como marcadores, cookies y preferencias.


## Componentes Navegador Web

```
https://www.html5rocks.com/es/tutorials/internals/howbrowserswork/ 37
```

## Navegador Web


## CRP: critical-rendering-path

https://hackernoon.com/optimising-the-front-end-for-the-browser-f2f51a29c572
Podemos ver el CRT (ruta acceso de representación crítica ) con la línea de tiempo de las herramientas de
desarrolladores. 39


## Motor de Renderizado

★Un motor de renderizado (web browser engine) es el software que toma
contenido marcado (como HTML, XML, archivos de imágenes, etc.) e
información de formateo (como CSS, XSL, etc.) y luego muestra el
contenido ya formateado en la pantalla.
✓Los motores de renderizado lo usan los navegadores web, clientes de
correo electrónico, u otras aplicaciones que deban mostrar
contenidos web.
✓Cada motor de renderizado del navegador suele tener su propio
intérprete javascript no son realmente lo mismo. Mientras que la
función del motor del navegador es renderizar y pintar la parte
gráfica de la web, el motor de javascript es el intérprete del
código y quien ejecuta un script en función de unas instrucciones.


## Flujo básico del motor de renderización

1. Los árboles DOM y CSSOM se combinan para formar el árbol de representación.
2. Render tree: El árbol de representación sólo contiene los nodos necesarios para
    representar la página.
3. Layout: El diseño calcula la posición y el tamaño exactos de cada objeto.
4. Paint: El último paso es la pintura, que recibe el árbol de representación final y
    representa los píxeles en la pantalla.

https://developers.google.com/web/fundamentals/performance/critical-rendering-path/render-tree-construction?hl=es-419


## Render Tree


<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Hola</title>
<script type="text/javascript">
var Autor="";
var node0;
function borrar(val) {
node0=val;
console.info("nodo a borrar:"+node0.nodeName);
console.info("val:"+val.nodeName);
var node=val.parentNode;
node.removeChild(node0)
alert("¿Algo borrado ?");
}

function recuperar(Id) {
var node = document.getElementById(Id);
node.appendChild(node0);
alert("nodo recuperado:");

}

## Ejemplo JavaSCRIP DOM NO USAR

```
43
```
```
</script></head>
<body>
<h1>Hola Mundo</h1>
<div id="principal">
<p id="borrar">Mueve ratón <span
onMouseOver="borrar(this) ;"> AQUÍ</span>:</p>
<p>Venga, Has borrado algo ¿Necesitas
Ayuda?</span></p>
<p><span onClick="recuperar('borrar');">PULSA
AQUI</span> para recuperar el original</p>
<p>FIN</p>
</div>
</body>
</html>
```
```
http://dllido.al.nisu.org/Lab2017/T4/HTML_DOM.html
```
```
Que vale document.getElementById(“Fin”):● si el script se pone en el Head?
●● si el script se pone al principio del Body?si el script se pone al final del Body?
```

★¿Cómo modifico un documento
cargado en el navegador?
★¿Por qué es diferente el manejo
del DOM en php y HTML?
★ Diferencia entre innerHTML y
contentText.
★¿Se carga primero el body o se
ejecuta primero el script?
★¿Por qué da error el siguiente
código?

## Cuestiones DOM

https://dllido.al.nisu.org/Lab2017/T4/FormEventHandlerError.html (^44)
**<!DOCTYPE html><html>
<head><meta** (^) **charset="utf-8">
<title><script Holatype</title>="text/javascript"** (^) **>**
(^) **father=document.querySelector(var father, child;** (^) **'head');
child = document.createElement( child.textContent='HTMLDOM'; 'title');
father.appendChild(child); father=document.querySelector(** (^) **‘body’);
child = document.createElement( h1.textContent=‘Bienvenido <span > Pepe </span>‘'h1');** (^) **;
father.appendChild(child); </script>
</head><body >** (^)
(^) **</html></body>**


## 4.4 JAVASCRIPT EN EL NAVEGADOR

###### ★El código JS, se puede poner:

###### ✓Como valor de un atributo que es un evento.

```
<button onclick="return handleClick(event, this);”>
```
###### ✓Dentro de la etiqueta <script > tanto en la

###### cabecera como en el body.

###### <script > console.log(‘hola’);</script>

###### ✓ En un fichero externo

###### <script src=“url”></script>


## 4.4-a BOM: Browse Object Model

✓ https://javascript.info/browser-environment


## BOM

**[http://www.cs.ucc.ie/~gavin/javascript/05_img01.gif](http://www.cs.ucc.ie/~gavin/javascript/05_img01.gif)**


## 4.4-b Event Target INTERFACE

★EventTarget permite detectar/recibir los eventos que se
producen en el DOM o BOM
★Windows, Document y Element soportan definir detectores de
eventos, “event hanlers”.
★Métodos EventTarget:
✓x.addEventListener() //Register an event handler of a specific event type for the eventTarget
**x.addEventListener ("Evento", funcionEjecutar,Boolean*)**
El “evento” es el nombre del evento “click”, “load”,
El **Boolean es opcional** especifica si el evento debe ser capturado
(true) o no debe serlo (false, que es el valor que se aplica por
defecto si no se especifica este parámetro).
✓EventTarget.removeEventListener() //Removes an event listener from the EventTarget.
✓EventTarget.dispatchEvent() //Dispatch an event to this EventTarget.


## 4.4-C Window Object

## ★ El objeto window es el de mayor nivel en la jerarquía de^

objetos de JavaScript en el navegador.
★ **Window** es el objeto "raíz" en las **API Web** de los
navegadores. Tiene dos funciones:
✓ Ser un objeto global en JavaScript. Contiene todas las
variables y funciones globales
✓ Representa la "ventana del navegador" y proporciona
métodos para controlarlo.
★ El objeto window representa la ventana que contiene un
documento DOM; la propiedad document
(window.document)apunta al DOM document cargado.


## Window: Global

★ Como en JavaScript todo son objetos, cuando estamos en el
navegador el objeto por defecto es window.
★ El objeto window es un objeto global y se puede omitir
cuando se quiere acceder a sus propiedades y métodos.
window.alert(‘error');
alert(“sin window!”);

★ **this** fuera de un objeto se referirá al objeto Window.
**Window.document** contiene el documento HTML activo cargado en la ventana.


## 4.4 -D Document Object

```
★Es el Nodo raíz que representa todo el DOM
★Todos los nodos heredan los atributos del objeto
eventTarget
```
★Atributos:
✓document.documentURI
✓document.contentType
✓document.styleSheets


## Document Object

★El objeto **document** contiene todo documento.
document.open();
window.document.write(“<p>a test1 message</p>”);
document.writeln(“<p> a test message</p>”);
document.close()
//indica al navegador que el documento se ha cargado
correctamente tras escribir en el.
¿Donde se escribe?

```
document.images
/lista de imágenes del
documento
document.anchors
//lista de hiperenlaces.
document.body
// nodo elemento body.
```

## 4.4 -E Element y Document Object

★Propiedades:
✓X.events //lista de Eventos de x
✓x.methods // lista de métodos de x
✓x.elements // colección de nodos de tipo elementos de x
✓x.name // lista de hijos de X con el nombre 'name'
✓x.innerHTML // asigna o devuelve el contenido html del nodo elemento(Crítico).
✓x.style// permite dar estilo a las etiquetas.
★Eventos:
✓blur() :Quita el foco en de un elemento.
✓click(): realiza un click en un elemento.
✓focus(): Pone el foco en un elemento.
✓toString():convierte el contenido de un elemento en una cadena.


## 4.4 -F This object

★El valor del objeto **this** :
■Cuando estamos dentro del atributo de una etiqueta **html** ,
this se refiere a la **etiqueta** que contiene el atributo.
■Cuando estamos en un programa , **this.xxx** se llama dentro de
un método propiedad, refiere al **objeto** que lo contiene.
■Cuando estamos en un programa , **this** se llama dentro de una
función, se refiere a la variable global, **window**
https://developer.mozilla.org/es/docs/Web/JavaScript/Referencia/Operadores/this


## EjemploS THIS

var o = {
prop: 37 ,
f: function() {
return this.prop;
}};
**console.log(o.f()); // logs 37**
function bluify(e){
console.log(this === e.currentTarget); // Siempre true
this.style.backgroundColor = '#A5D9F3';
}
// x un elemento HTML
**x.** .addEventListener('click', bluify, false);


**https://dllido.al.nisu.org/Lab2017/T4/FormEventHandlerType.
html**

## Ejemplos


## 5 <template>: document fragment

**<table id="producTable">
<thead>
<tr>
<td>UPC_Code</td>
<td>Product_Name</td>
</tr>
</thead>
<tbody>
<!-- Si existen datos se incluye aqui -->
</tbody>
</table>**

**<template id="productRow">
<tr>
<td class="record"></td>
<td></td>
</tr>**

**</template>** (^5)
★El contenido del nodo
<template> es un
**document fragment**.
Este se representa en
un árbol del DOM
distinto al documento
HTML. Un document
Fragment no tiene nodo
padre.


## <template>: document fragment

**document.addEventListener(<script type="text/javascript""DOMContentLoaded">**^ **, function () {**

(^) **if (document.querySelector(// Test to see if the browser supports the HTML template.'template').content) {
// Instantiate the table var t = document.querySelector(** (^) **'#productRow'),
td = t.content.querySelectorAll( td[ 0 ].textContent = "1235646565""td"; );
td[ 1 ].textContent = "Stuff";
// Clone the new row and insert it into the tablevar tb = document.getElementsByTagName("tbody"** (^) **);**
(^) **tb[var 0 clone = document.importNode(t.content, ].appendChild(clone); true);**
(^) **// Create a new row
td[ td[**^01 **].textContent = ].textContent = "0384928528""Acme Kidney Beans";**^ **;**
(^) **// Clone the new row and insert it into the table**
(^) **tb[var 0 clone2 = document.importNode(t.content, ].appendChild(clone2); true);
}}); </script>** (^)
(^)
**https://mdn.mozillademos.org/en-US/docs/Web/HTML/Element/template$samples/Example?revision=934131** 58
**</head> <body>** (^)
**<table <thead>id="producTable" >
<tr><td>** (^) **UPC_Code</td>**
(^) **</tr><td> Product_Name</td>
</thead><tbody>**
(^) **</tbody><!-- existing data could optionally be included here -->
</table>
<template <tr> id="productRow">
<td <td></td>class= "record"></td>**
(^) **</template></tr>** (^)
(^) **</html></body>**


## 6 JSON:Dato Esctruturado

★JSON, acrónimo de **JavaScript Object Notation** , es un
formato ligero para el intercambio de datos.
★JSON es un subconjunto de la notación literal de objetos
de la especificación de JavaScript y por ello soportada por
JavaScript.


## Propiedades JSON

★Ligero: formato ligero para el intercambio de datos
★Simple
✓Formato sencillo de leer por humanos
✓y de parsear/analizar por máquinas
★Funcional: Los objetos JSON están tipificados. Mientras
en JavaScript todo son cadenas.
★Abierto: Formato de texto independiente del lenguaje.
★Extensible: formado por unas estructuras que pueden
anidarse.


## Estructura Datos JSON

★JSON es una sintaxis para serializar objetos, arreglos, números,
cadenas, booleanos y nulos. 
★La estructura de datos de JSON está basada en pares nombre:valor
★Las 2 estructuras principales son el objeto Json y la Lista JSON.

```
61
```
```
<menu <popup>id="file" value="File">
<menuitem <menuitem valuevalue=="Open""New"^ onclick onclick=="CreateNewDoc()""OpenDoc()" /> />^
```
(^) </popup><menuitem value="Close" onclick="CloseDoc()" />
</menu>


## Valores JSON

Un valor puede ser una cadena de caracteres con
comillas dobles, o un número, o true o false o
null, o un objeto o un arreglo. Estas estructuras
pueden anidarse


## Objeto JSON

★Un objeto es un conjunto desordenado de pares
nombre/valor.
★Cada nombre es seguido por : (dos puntos) y los pares
nombre/valor están separados por , (coma).
★Un objeto se encapsula entre llaves. {} 


## Estructura Array JSON

★Un array es una colección de valores.
★Un array se encapsula entre corchetes.[]
★Los valores se separan por comas “, “.


## Métodos Objeto JSON

```
★El objeto JSON contiene métodos:
✓JSON .parse (): Analiza una cadena de texto con formato
JSON opcionalmente transformando el valor producido y sus
propiedades, retornando un JSON.
✓JSON .stringify (): Devuelve un string a partir de un JSON,
incluyendo opcionalmente ciertas propiedades o
reemplazando valores de propiedades de la manera definida
por el usuario
★No puede ser llamado o construido
```
.


## Acceso elementos Objeto JSON

JSONdata={"menu": {
"id": "file",
"value": "File",
"popup": {
"menuitem": [
{"value": "New", "onclick": "CreateNewDoc()"},
{"value": "Open", "onclick": "OpenDoc()"},
{"value": "Close", "onclick": "CloseDoc()"}
]
}
}}

varvar menu = JSONdata.menu; fichero = JSONdata.menu.value; (^)
varvar submenu = JSONdata.menu.menuitem[ submenuVal = JSONdata.menu.popup.menuitem[ 0 ]; (^0) ]["value"]


★ Construye un el Json //{"bar":"new property”,"baz":3}

★ Construye un el Json //["pepe","Jose"]

## Ejercicios

vfoo.bar = ar foo = {};"new property" (^) ;
foo.baz = 3 ;
varconsole.log (jsonString); jsonString = JSON.stringify(foo);
//{"bar":"new property","baz":3}


## JSON HTTP

★Envío
✓Crear objeto JSON
✓Añadir pares nombre/valor
✓Convertir JSON a una cadena
✓En el envío indicar al protocolo HTTP que se envían datos
Json
★Recepción:
✓Recibir cadena con objeto JSON
■En **js** Convertir a objeto Json
■En **php** convertir el Json a un diccionario


## Ejemplo envío JSON con JavaScript

var foo = {};
foo.bar = "new property";
foo.baz = 3 ;
var jsonString = JSON.stringify(foo);
console.log (jsonString);
//{"bar":"new property","baz":3}
var url = "JSONExample3.php createXMLHttpRequest();
xmlHttp.open("POST", url, true);
xmlHttp.setRequestHeader("Content-Type","application/json;charset=UTF-8");”);
xmlHttp.onreadystatechange = handleStateChange;

xmlHttp.send(json);


## 7-JSON PHP

★Funciones:
✓ **json_encode** (cadena): Función que devuelve un objeto o
arreglo a partir de una cadena con sintaxis JSON.
✓ **json_decode** (dato); función que devuelve un objeto o
arreglo en formato cadena con sintaxis JSON.


## Ejemplo procesar JSON con PHP

$json =
'[{"0":"1","id_fruta":"1","1":"Manzana","nombre_fruta":"Manzana
","2":"100","cantidad":"100"},{"0":"2","id_fruta":"2","1":"Platano",
"nombre_fruta":"Platano","2":"167","cantidad":"167"},{"0":"3","id
_fruta":"3","1":"Pera","nombre_fruta":"Pera","2":"820","cantidad
":"820"}]';
$array = json_decode($json);
print_r($_array)
//OBTENER UN DATO DIRECTAMENTE DEL ARRAY.
echo $array[ 0 ]->nombre_fruta;
//RECORRER Y RECUPERAR VALORES JSON CON
FOREACH.
foreach($array as $obj){
$id_fruta = $obj->id_fruta;
$nombre_fruta = $obj->nombre_fruta;
$cantidad = $obj->cantidad;
echo $id_fruta." ".$nombre_fruta." ".$cantidad;
}

```
1 Manzana 1002 Plátano 167
3 Pera 820
```
```
Array ( [0] => stdClass Object ( [0] => 1 [id_fruta] => 1 [1] => Manzana [nombre_fruta] => Manzana [2] => 100 [cantidad]
=> 100 ) [1] => stdClass Object ( [0] => 2 [id_fruta] => 2 [1] => Platano [nombre_fruta] => Platano [2] => 167 [cantidad]
=> 167 ) [2] => stdClass Object ( [0] => 3 [id_fruta] => 3 [1] => Pera [nombre_fruta] => Pera [2] => 820 [cantidad] =>
820 ) )
```

## Ejemplo envío una tabla con JSON

[{"id":"1","nombre":"pepe","apellido":null,"email":null,"c
lave":null},{"id":"2","nombre":"pepe","apellido":null,"emai
l":null,"clave":null}]

```
header('Content-type: application/json');
$result= $pdo->prepare("SELECT * FROM usuarios ");
$result->execute();
$datos= $result->fetchAll(PDO::FETCH_ASSOC);
echo json_encode($datos);
```
```
https://dllido.al.nisu.org/Lab2017/T4/jsonTemplate0.php
```

var datos=
[{"id":"1","nombre":"pepe","apellido":null,"email":null,"clave":null},
{"id":"2","nombre":"pepe","apellido":null,"email":null,"clave":null}]

```
var t = document.querySelector('#productrow');
var tb = document.getElementsByTagName("tbody");
var clone;
```
td = t.content.querySelectorAll("td");
for (var i = 0; i < datos.length; i++){

```
td[0].textContent =datos[i].id;
td[1].textContent = datos[i].nombre;
clone = document.importNode(t.content, true);
tb[0].appendChild(clone);
}
73
https://dllido.al.nisu.org/Lab2017/T4/listarTemplate0.html
```
```
<table
id="producttable">
<thead>
<tr>
<td>UserID</td>
<td>UserName</td
>
</tr>
</thead>
<tbody>
</tbody>
</table>
<template
id="productrow">
<tr>
<td
class="record"></td>
<td></td>
</tr>
</template>
```

✓ https://dom.spec.whatwg.org/ DOM LIVE
✓ https://www.html5rocks.com/es/tutorials/internals/howbrow
serswork/

## Bibliografía


